import{initializeApp}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";import{getAuth,onAuthStateChanged,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";import{getFirestore,doc,setDoc,getDoc}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("menu-toggle"),t=document.getElementById("menu"),n=document.getElementById("close-menu-btn"),o=document.getElementById("dark-toggle"),c=document.body,a=document.getElementById("trader-quote"),s=document.getElementById("signup-form"),l=document.getElementById("login-form"),r=document.getElementById("logout-btn"),d=document.getElementById("form-message");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("open"),e.classList.toggle("close")}),n&&t&&n.addEventListener("click",()=>{t.classList.remove("active"),e.classList.remove("open","close")}),"dark"===localStorage.getItem("theme")?(c.classList.add("dark-mode"),o&&(o.textContent="‚òÄÔ∏è")):o&&(o.textContent="üåô"),o&&o.addEventListener("click",()=>{c.classList.toggle("dark-mode");const e=c.classList.contains("dark-mode");localStorage.setItem("theme",e?"dark":"light"),o.textContent=e?"‚òÄÔ∏è":"üåô"}),"undefined"!=typeof AOS&&AOS.init({duration:1e3,once:!0});const i=["Every expert was once a beginner ‚Äî start your journey today.","Small consistent steps build big trading success.","Mistakes, failure, humiliation, disappointment and rejection are all a part of growth.","In trading, patience is not just a virtue ‚Äî it‚Äôs a profit strategy.","Learn before you earn ‚Äî the market rewards preparation.","A disciplined trader turns losses into lessons.","Trading is not about speed, it‚Äôs about direction.","Risk is the cost of opportunity ‚Äî manage it wisely.","Your first trade is not the end goal, it‚Äôs the starting line.","Charts don‚Äôt lie, but traders who read them well succeed.","The best investment you can make is in your trading education."];let u=0;if(a){const e=()=>{a.style.opacity=0,setTimeout(()=>{a.textContent=i[u],a.style.opacity=1,u=(u+1)%i.length},800)};e(),setInterval(e,5e3)}document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("keydown",e=>{(e.ctrlKey&&["c","u","s"].includes(e.key.toLowerCase())||"PrintScreen"===e.key)&&e.preventDefault()});const m={apiKey:"AIzaSyDa5EPtNbmugtaIMiIaYmVtapYsvU7biMc",authDomain:"tradingekmission.firebaseapp.com",projectId:"tradingekmission",storageBucket:"tradingekmission.firebasestorage.app",messagingSenderId:"301971513060",appId:"1:301971513060:web:a6027176e12af4b227d6f1",measurementId:"G-C0W3J8LNSE"},g=initializeApp(m);getAnalytics(g);const y=getAuth(g),f=getFirestore(g),p=window.location.pathname.split("/").pop();"signup.html"===p&&s&&s.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("email").value.trim(),n=document.getElementById("password").value.trim(),o=document.getElementById("confirm-password").value.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return void(d.textContent="‚ùå Please enter a valid email address.");if(n!==o)return void(d.textContent="‚ùå Passwords do not match!");if(n.length<8)return void(d.textContent="‚ö†Ô∏è Password must be at least 8 characters.");if(!/[!@#$%^&*]/.test(n))return void(d.textContent="‚ö†Ô∏è Password must contain a special character (!@#$%^&*).");try{await createUserWithEmailAndPassword(y,t,n),d.textContent="‚úÖ Signup successful! Redirecting...",setTimeout(()=>window.location.href="login.html",1500)}catch(e){d.textContent=`‚ùå ${e.message}`}}),"login.html"===p&&l&&l.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("email").value.trim(),n=document.getElementById("password").value.trim();try{await signInWithEmailAndPassword(y,t,n),d.textContent="‚úÖ Login successful! Redirecting...",setTimeout(()=>window.location.href="course.html",1500)}catch(e){d.textContent=`‚ùå ${e.message}`}}),onAuthStateChanged(y,async e=>{const t=["beginner.html","technical.html","advance.html"];if(!e&&t.includes(p))return void(window.location.href="login.html");if("course.html"===p&&(document.querySelectorAll(".course-lock-icon").forEach(t=>{t.classList.toggle("fa-lock",!e),t.classList.toggle("locked",!e),t.classList.toggle("fa-unlock",!!e),t.classList.toggle("unlocked",!!e)}),e&&await h(e.uid)),r&&(r.style.display=e?"block":"none"),e){const t=document.querySelectorAll(".course-container");for(const n of t){const t=n.querySelector(".lessonList"),o=n.getAttribute("data-course-id");if(t){const c=t.querySelectorAll("li"),a=doc(f,"users",e.uid),s=await getDoc(a),l=s.exists()?s.data():{};let r=new Set(l[o]||[]);c.forEach((t,c)=>{r.has(c)&&t.classList.add("completed"),t.addEventListener("click",async()=>{t.classList.toggle("completed"),t.classList.contains("completed")?r.add(c):r.delete(c),await setDoc(a,{...l,[o]:Array.from(r)}),"course.html"===p&&await h(e.uid)})})}}}}),r&&r.addEventListener("click",()=>signOut(y)),document.querySelectorAll(".toggle-btn").forEach(e=>{const t=document.getElementById(e.dataset.target);t&&(t.style.display="none",e.innerHTML="<strong>Show More Content</strong>",e.addEventListener("click",()=>{const n="none"===t.style.display;t.style.display=n?"block":"none",e.innerHTML=`<strong>${n?"Show Less":"Show More"} Content</strong>`,e.setAttribute("aria-expanded",!n)}))});async function h(e){const t=document.getElementById("combinedProgressBar"),n=document.getElementById("progressText");if(t){const o=["beginnerCourse","technicalCourse","advanceCourse"],c={beginnerCourse:15,technicalCourse:25,advanceCourse:20};try{const a=doc(f,"users",e),s=await getDoc(a),l=s.exists()?s.data():{};let r=0,d=0;o.forEach(e=>{r+=(l[e]||[]).length,d+=c[e]});const m=d>0?Math.round(r/d*100):0;t.style.width=m+"%",t.textContent=m+"%",n&&(n.textContent=`Total lessons completed: ${r} / ${d}`)}catch(e){console.error("Error updating progress:",e)}}}});
